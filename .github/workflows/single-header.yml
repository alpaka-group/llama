name: Publish amalgamated llama.hpp to single-header
on:
  push:
    branches:
      - develop

jobs:
  single-header:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - name: clone single-header
      run: |
        git clone -b single-header https://x-access-token:${{secrets.github_token}}@github.com/${{github.repository}}.git single-header
    - name: create-single-header.sh
      run: |
        ./tools/create-single-header.sh
    - name: commit
      run: |
        set -x
        cd single-header
        git config --global user.email "action@github.com"
        git config --global user.name "GitHub Action"
        git add llama.hpp
        if (git diff --quiet) || (git diff --staged --quiet)
        then
          git commit -m "Update llama.hpp"
          git push origin single-header
        else
          echo "No changes to commit"
        fi
        git push
